/*Using the fielding table, group players into three groups based on their position:
label players with position OF as "Outfield", those with position "SS", "1B", "2B", and "3B" as "Infield",
and those with position "P" or "C" as "Battery".
Determine the number of putouts made by each of these three groups in 2016.*/

SELECT pos,
	CASE WHEN pos = 'OF' then 'Outfield'
		WHEN pos = 'SS' THEN 'Infield'
		WHEN pos = '1B' THEN 'Infield'
		WHEN pos = '2B' THEN 'Infield'
		WHEN pos = '3B' THEN 'Infield'
		WHEN pos = 'P' THEN 'Battery'
		WHEN pos = 'C' THEN 'Battery' END AS fielding_grouped
FROM fielding

SELECT pos,
	CASE WHEN pos = 'OF' then 'Outfield'
		WHEN pos = 'SS' THEN 'Infield'
		WHEN pos = '1B' THEN 'Infield'
		WHEN pos = '2B' THEN 'Infield'
		WHEN pos = '3B' THEN 'Infield'
		WHEN pos = 'P' THEN 'Battery'
		WHEN pos = 'C' THEN 'Battery' END AS fielding_grouped
FROM fielding
GROUP BY fielding_grouped, fielding.pos

SELECT pos, COUNT(PO), fielding.yearid,
	CASE WHEN pos = 'OF' then 'Outfield'
		WHEN pos = 'SS' THEN 'Infield'
		WHEN pos = '1B' THEN 'Infield'
		WHEN pos = '2B' THEN 'Infield'
		WHEN pos = '3B' THEN 'Infield'
		WHEN pos = 'P' THEN 'Battery'
		WHEN pos = 'C' THEN 'Battery' END AS fielding_grouped
FROM fielding
GROUP BY fielding_grouped, fielding.pos, fielding.yearid

WITH grouped_fielding AS (SELECT DISTINCT pos, SUM(PO) AS total_po, fielding.yearid,
		CASE WHEN pos = 'OF' then 'Outfield'
			WHEN pos = 'SS' THEN 'Infield'
			WHEN pos = '1B' THEN 'Infield'
			WHEN pos = '2B' THEN 'Infield'
			WHEN pos = '3B' THEN 'Infield'
			WHEN pos = 'P' THEN 'Battery'
			WHEN pos = 'C' THEN 'Battery' END AS fielding_grouped
	FROM fielding 
	WHERE yearid = (2016)
	GROUP BY fielding_grouped, fielding.pos, fielding.yearid
	ORDER BY yearid)

SELECT SUM(total_po), fielding_grouped
FROM grouped_fielding
GROUP BY fielding_grouped
--A: Outfield = 29,560, Battery = 41,424, Infield = 58,934
